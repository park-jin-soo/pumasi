<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¸”ë¡œê·¸ ìë™í™” ì„¼í„° V3.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        
        /* [ì‹ ê·œ] 3ë‹¨ ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ */
        .main-layout {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .banner-container {
            width: 180px; /* ë°°ë„ˆ ì»¨í…Œì´ë„ˆ ë„ˆë¹„ */
            flex-shrink: 0;
            padding-top: 8rem; /* í—¤ë” ë†’ì´ë§Œí¼ íŒ¨ë”© ì¶”ê°€ */
        }
        .banner-container img {
            width: 100%;
            margin-bottom: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .app-container {
             max-width: 800px;
             width: 100%;
        }
        /* í™”ë©´ì´ 1200pxë³´ë‹¤ ì‘ì•„ì§€ë©´ ë°°ë„ˆ ìˆ¨ê¹€ */
        @media (max-width: 1200px) {
            .banner-container {
                display: none;
            }
        }
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ */
        .header { padding: 2rem 0; text-align: center; }
        .header h1 { font-weight: 700; }
        .auth-container { max-width: 400px; margin: auto; }
        .hidden { display: none; }
        .spinner-border { width: 1.5rem; height: 1.5rem; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem; }
        .calendar-title { display: flex; align-items: baseline; gap: 0.75rem;}
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .calendar-day-name { text-align: center; font-weight: bold; color: #6c757d; padding-bottom: 0.5rem;}
        .calendar-day { background-color: #fff; border: 1px solid #e9ecef; border-radius: 0.375rem; min-height: 80px; padding: 0.5rem; display: flex; flex-direction: column; font-size: 0.9rem; }
        .calendar-day .day-number { font-weight: bold; }
        .calendar-day.sunday .day-number { color: #dc3545; }
        .calendar-day.saturday .day-number { color: #0d6efd; }
        .calendar-day .link-count { font-size: 0.75rem; color: #198754; font-weight: bold; margin-top: auto; align-self: flex-end; }
        .calendar-day.other-month { background-color: #f8f9fa; color: #ced4da; }
        .calendar-day.today { border: 2px solid #198754; position: relative; }
        .calendar-day.active-day { cursor: pointer; border-color: #0d6efd; box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.25); }
        .calendar-day.active-day:hover { background-color: #e9f5ee; }
        .nav-tabs .nav-link.active { font-weight: bold; }
        #completionBtn:disabled { cursor: not-allowed; }
        .penalty-1 { color: #ffc107; }
        .penalty-2 { color: #fd7e14; }
        .penalty-3 { color: #dc3545; font-weight: bold; }
        .today-marker { font-weight: bold; color: #d63384; text-align: center; animation: pulse 1.5s infinite; margin-top: 4px; }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .rules-box { background-color: #eef7ff; border-left: 5px solid #0d6efd; padding: 1rem; margin-bottom: 1.5rem; font-size: 0.9rem; }
        .penalty-info { list-style-type: none; padding-left: 0; }
        .penalty-info li { margin-bottom: 0.5rem; }
        .penalty-info .badge { margin-right: 8px; }
        .status-active { color: #198754; font-weight: bold; }
        .status-blocked { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="main-layout">
        <div id="left-banners" class="banner-container"></div>
        
        <div class="app-container">
            <header class="header"><h1>ë¸”ë¡œê·¸ ìë™í™” ì„¼í„° V3.0</h1></header>

            <div class="alert alert-warning border-warning mb-3" style="background-color: #fff3cd; border-left: 5px solid #ffc107;">
                <div class="text-center">
                    <strong style="color: #856404;">ì˜¤í”ˆì±„íŒ…ë°© ê°€ì…íšŒì›ë§Œ íšŒì›ê°€ì…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</strong><br>
                    <span style="color: #dc3545; font-weight: bold;">ë¸”ë¡œê·¸ ëŒ€í–‰ì‚¬, ì‹¤í–‰ì‚¬ ë“± ê´€ë ¨ ë§ˆì¼€í„°ëŠ” ì ë°œì‹œ ë°”ë¡œ ë‚´ë³´ë‚´ê¸° ë©ë‹ˆë‹¤.</span>
                </div>
            </div>

            <div class="text-center mb-4">
                <a href="https://open.kakao.com/o/g0BjbBQh" target="_blank" rel="noopener noreferrer" class="btn btn-warning fw-bold">
                    ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°©ìœ¼ë¡œ ë“¤ì–´ê°€ê¸°
                </a>
            </div>

            <div id="authView">
                <div class="card auth-container">
                    <div class="card-body p-4">
                        <ul class="nav nav-tabs nav-fill mb-4" id="authTab" role="tablist">
                          <li class="nav-item" role="presentation"><button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab">ë¡œê·¸ì¸</button></li>
                          <li class="nav-item" role="presentation"><button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab">íšŒì›ê°€ì…</button></li>
                        </ul>
                        <div class="tab-content">
                          <div class="tab-pane active" id="login" role="tabpanel"><h5 class="card-title text-center mb-3">ë¡œê·¸ì¸</h5><div class="mb-3"><label for="loginIdInput" class="form-label">ë¸”ë¡œê·¸ ì•„ì´ë””</label><input type="text" class="form-control" id="loginIdInput"></div><div class="d-grid"><button id="loginButton" class="btn btn-primary">ë¡œê·¸ì¸</button></div></div>
                          <div class="tab-pane" id="register" role="tabpanel"><h5 class="card-title text-center mb-3">íšŒì›ê°€ì…</h5><div class="mb-3"><label for="registerIdInput" class="form-label">ë¸”ë¡œê·¸ ì•„ì´ë””</label><input type="text" class="form-control" id="registerIdInput" placeholder="ë¸”ë¡œê·¸ë‹‰ë„¤ì„ì´ ì•„ë‹Œ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"></div><div class="mb-3"><label for="registerLinkInput" class="form-label">ë¸”ë¡œê·¸ ë§í¬ (ëª¨ë°”ì¼)</label><input type="url" class="form-control" id="registerLinkInput" placeholder="https://m.blog.naver.com/ì•„ì´ë””" readonly></div><div class="mb-3"><label for="registerPostCountInput" class="form-label">1ì£¼ì¼ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ… íšŸìˆ˜(3íšŒ ì´í•˜ ê°€ì…ê¸ˆì§€)</label><input type="number" class="form-control" id="registerPostCountInput" placeholder="ìµœì†Œ 3íšŒ ì´ìƒ" min="0"></div><div class="mb-4"><h6 class="fw-bold text-primary mb-3">ì•ˆë‚´ë¬¸ - ê¼­ ì½ì–´ë³´ì„¸ìš”</h6><div class="border p-3 mb-3" style="background-color: #f8f9fa; font-size: 0.9rem; line-height: 1.5;"><p class="mb-2">ì˜¤í”ˆì±„íŒ…ë°© ê°€ì…ì€ ìƒë‹¨ í´ë¦­í›„ ê°€ì…í•˜ì„¸ìš”</p><p class="mb-2">ë³¸ í’ˆì•—ì´ í”„ë¡œê·¸ë¨ ë° ë¸”ë¡œê·¸ ê´€ë ¨í”„ë¡œê·¸ë¨ ì‚¬ìš©í•˜ì‹œë ¤ë©´ ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°©ì˜ íšŒì›ì— í•œí•´ì„œë§Œ ê°€ì…ì´ ìŠ¹ì¸ ì´ë©ë‹ˆë‹¤.</p><p class="mb-2">ì €í¬ ì±„ìš°ë¯¸ ìë™í’ˆì•—ì´ íšŒì›ìœ¼ë¡œ í™œë™í•˜ì‹œë ¤ë©´ 1ì£¼ì¼ ìµœì†Œ3íšŒ ì´ìƒ ì›” 12íšŒ ì´ìƒì˜ í¬ìŠ¤íŒ…ì„ ìœ ì§€í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.</p><p class="mb-2">í’ˆì•—ì´ë¥¼ ê¸°ë³¸ìœ¼ë¡œ í•˜ëŠ” ë°©ì´ë¯€ë¡œ í”„ë¡œê·¸ë¨ë§Œ ì‚¬ìš©í•˜ì‹œë ¤ í•˜ì‹ ë‹¤ë©´ ì£„ì†¡í•˜ì§€ë§Œ ê°€ì…ì´ ì–´ë µìŠµë‹ˆë‹¤.</p><p class="mb-0">í’ˆì•—ì´ ë³´ë‹¤ ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ ì‚¬ìš©ëŸ‰ì´ ë§ì•„ì§ˆê²½ìš° ìœ ë£Œë¡œ ì „í™˜ í•  ì˜ˆì •ì…ë‹ˆë‹¤.</p></div><div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="isMemberCheck"><label class="form-check-label" for="isMemberCheck">íšŒì›ì´ì‹  ê°€ìš”?</label></div><div class="form-check mb-3"><input class="form-check-input" type="checkbox" id="agreeTermsCheck"><label class="form-check-label" for="agreeTermsCheck">ì•ˆë‚´ë¬¸ ë‚´ìš© í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.</label></div></div><div class="d-grid"><button id="registerButton" class="btn btn-success">ê°€ì…í•˜ê¸°</button></div></div>
                        </div>
                        <div id="authAlert" class="alert mt-3 hidden" role="alert"></div>
                    </div>
                </div>
            </div>
            <main id="mainView" class="hidden">
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div><p class="mb-1"><strong><span id="welcomeMessage"></span></strong>ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤.</p><small class="text-muted" id="userInfoText"></small></div>
                            <div><button id="adminLoginBtn" class="btn btn-sm btn-outline-danger me-2">ê´€ë¦¬ì</button><button id="logoutButton" class="btn btn-sm btn-outline-secondary">ë¡œê·¸ì•„ì›ƒ</button></div>
                        </div>
                    </div>
                </div>
                <ul class="nav nav-tabs nav-fill mb-3" id="mainAppTab" role="tablist">
                  <li class="nav-item" role="presentation"><button class="nav-link active" id="submission-tab" data-bs-toggle="tab" data-bs-target="#submission" type="button" role="tab">í’ˆì•—ì´ ë§í¬ ì €ì¥</button></li>
                  <li class="nav-item" role="presentation"><button class="nav-link" id="completion-tab" data-bs-toggle="tab" data-bs-target="#completion" type="button" role="tab">í’ˆì•—ì´ ì™„ë£Œ í™•ì¸</button></li>
                  <li class="nav-item" role="presentation"><button class="nav-link" id="downloads-tab" data-bs-toggle="tab" data-bs-target="#downloads" type="button" role="tab">í’ˆì•—ì´ ë¯¸ì™„ë£Œ</button></li>
                </ul>
                <div class="tab-content">
                  <div class="tab-pane active" id="submission" role="tabpanel">
                      <div class="rules-box">
                          <h6 class="mb-2 fw-bold">ğŸ“¢ ë§í¬ ì €ì¥/ì‚­ì œ ê·œì¹™</h6>
                          <ul>
                              <li>í’ˆì•—ì´ì— ì°¸ì—¬í•  ë§í¬ëŠ” <strong>ë‹¹ì¼ 17ì‹œ 59ë¶„ê¹Œì§€</strong> ë“±ë¡/ìˆ˜ì •/ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                              <li>ê¸‰í•œ ì‚¬ì •ìœ¼ë¡œ í’ˆì•—ì´ê°€ ì–´ë µë‹¤ë©´, ë°˜ë“œì‹œ <strong>17ì‹œ 59ë¶„ê¹Œì§€ ë§í¬ë¥¼ ì‚­ì œ</strong>í•´ ì£¼ì„¸ìš”. <strong>18ì‹œ ì´í›„ì—ëŠ” ì‚­ì œê°€ ë¶ˆê°€</strong>í•©ë‹ˆë‹¤.</li>
                              <li>í’ˆì•—ì´ í™œë™ì„ ëª¨ë‘ ë§ˆì¹œ í›„, <strong>ë‹¹ì¼ 23ì‹œ 30ë¶„ê¹Œì§€ 'í’ˆì•—ì´ ì™„ë£Œ í™•ì¸' íƒ­ì—ì„œ ì™„ë£Œ ë³´ê³ </strong>ë¥¼ í•´ì•¼ íŒ¨ë„í‹°ë¥¼ ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                          </ul>
                      </div>
                      <div class="card"><div class="card-body"><div class="calendar-header"><button id="prevMonth" class="btn btn-outline-secondary">&lt;</button><div class="calendar-title"><h4 id="currentMonthYear" class="mb-0"></h4><span id="monthlyTotalCount" class="badge bg-secondary"></span></div><button id="nextMonth" class="btn btn-outline-secondary">&gt;</button></div><div class="calendar-grid"><div class="calendar-day-name sunday">ì¼</div><div class="calendar-day-name">ì›”</div><div class="calendar-day-name">í™”</div><div class="calendar-day-name">ìˆ˜</div><div class="calendar-day-name">ëª©</div><div class="calendar-day-name">ê¸ˆ</div><div class="calendar-day-name saturday">í† </div></div><div class="calendar-grid" id="calendarBody"></div></div></div>
                  </div>
                  <div class="tab-pane" id="completion" role="tabpanel">
                       <div class="rules-box">
                          <h6 class="mb-2 fw-bold">ğŸ“¢ ì™„ë£Œ í™•ì¸ ê·œì¹™ ë° íŒ¨ë„í‹° ì•ˆë‚´</h6>
                          <p class="mb-2">í’ˆì•—ì´ ì™„ë£Œ ë³´ê³ ëŠ” <strong>ë‹¹ì¼ ì €ë… 6ì‹œ 30ë¶„ ~ ë°¤ 11ì‹œ 30ë¶„</strong> ì‚¬ì´ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>ì‹œê°„ ë‚´ ì™„ë£Œ ë³´ê³ ë¥¼ í•˜ì§€ ì•Šì„ ê²½ìš° ë¯¸ì™„ë£Œë¡œ ì²˜ë¦¬ë˜ë©°, ì•„ë˜ì™€ ê°™ì´ íŒ¨ë„í‹°ê°€ ë¶€ê³¼ë©ë‹ˆë‹¤.</p>
                          <ul class="penalty-info">
                              <li><span class="badge bg-warning text-dark">íŒ¨ë„í‹° 1íšŒ</span><strong>ë´‰ì‚¬</strong> (ë³¸ì¸ ë§í¬ ì œì¶œ ë¶ˆê°€, ë‹¤ë¥¸ íšŒì› í’ˆì•—ì´ë§Œ ì§„í–‰)</li>
                              <li><span class="badge bg-danger">íŒ¨ë„í‹° 2íšŒ</span><strong>7ì¼ê°„ ì‚¬ìš© ê¸ˆì§€</strong></li>
                              <li><span class="badge bg-dark">íŒ¨ë„í‹° 3íšŒ</span><strong>íšŒì› ìê²© ë°•íƒˆ</strong></li>
                          </ul>
                      </div>
                      <div class="card mb-4"><div class="card-header"><h4>ê¸ˆì¼ í’ˆì•—ì´ ì™„ë£Œ ë³´ê³ </h4></div><div class="card-body text-center"><p id="completionTimer" class="text-muted"></p><button id="completionBtn" class="btn btn-success btn-lg" disabled>í’ˆì•—ì´ ì™„ë£Œ í™•ì¸</button></div></div>
                  </div>
                  <div class="tab-pane" id="downloads" role="tabpanel">
                       <div class="rules-box">
                          <h6 class="mb-2 fw-bold">ğŸ“¢ í’ˆì•—ì´ ë¯¸ì™„ë£Œ íšŒì› í˜„í™©</h6>
                          <ul>
                              <li><strong>ì–´ì œì í™œë™ ì™„ë£Œ ë³´ê³ ì„œ:</strong> ë§¤ì¼ ë°¤ 12ì‹œ 5ë¶„ ì´í›„ ìƒì„±ë˜ë©°, ë¯¸ì™„ë£Œ íšŒì› ë° íŒ¨ë„í‹° í˜„í™©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                              <li>ë¯¸ì™„ë£Œ íšŒì›ì€ ìë™ìœ¼ë¡œ íŒ¨ë„í‹°ê°€ ë¶€ê³¼ë˜ë©°, íŒ¨ë„í‹° íšŸìˆ˜ì— ë”°ë¼ ì œì¬ê°€ ì ìš©ë©ë‹ˆë‹¤.</li>
                          </ul>
                      </div>
                      <div class="card"><div class="card-header"><h4>ì–´ì œì ë¯¸ì™„ë£Œ íšŒì› ëª©ë¡</h4></div><div id="reportContent" class="card-body"><p class="text-center">ë³´ê³ ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p></div></div>
                  </div>
                </div>
            </main>
            <div id="adminView" class="hidden">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="d-flex align-items-center">
                        <h2 class="mb-0">ê´€ë¦¬ì ëª¨ë“œ</h2>
                        <button id="adminDownloadTodayLinksBtn" class="btn btn-success ms-3">ì˜¤ëŠ˜ ë§í¬ ëª©ë¡ ë‹¤ìš´ë¡œë“œ</button>
                    </div>
                    <button id="exitAdminBtn" class="btn btn-secondary">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
                <div id="adminAlert" class="alert mt-3 hidden" role="alert"></div>
                
                <ul class="nav nav-tabs nav-fill mb-3" id="adminTab" role="tablist">
                    <li class="nav-item" role="presentation"><button class="nav-link active" id="user-mgm-tab" data-bs-toggle="tab" data-bs-target="#user-mgm" type="button" role="tab">íšŒì› ê´€ë¦¬</button></li>
                    <li class="nav-item" role="presentation"><button class="nav-link" id="ad-mgm-tab" data-bs-toggle="tab" data-bs-target="#ad-mgm" type="button" role="tab">ê´‘ê³  ê´€ë¦¬</button></li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="user-mgm" role="tabpanel">
                        <div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>ì•„ì´ë””</th><th>ë¸”ë¡œê·¸ ë§í¬</th><th>ê°€ì…ì¼</th><th>ìƒíƒœ</th><th>íŒ¨ë„í‹°</th><th>ì ê¸ˆ ì¢…ë£Œì¼</th><th>ê´€ë¦¬</th></tr></thead><tbody id="adminUserTable"></tbody></table></div>
                    </div>
                    <div class="tab-pane" id="ad-mgm" role="tabpanel">
                         <div class="card">
                            <div class="card-header">ê´‘ê³  ë°°ë„ˆ ê´€ë¦¬</div>
                            <div class="card-body">
                                <p class="card-text small text-muted">
                                    ì¢Œì¸¡ ë°°ë„ˆëŠ” 1-5ë²ˆ, ìš°ì¸¡ ë°°ë„ˆëŠ” 6-10ë²ˆ ìŠ¬ë¡¯ì— í•´ë‹¹í•©ë‹ˆë‹¤.<br>
                                    ì´ë¯¸ì§€ URLê³¼ ì—°ê²°í•  ë§í¬ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ê³  'ì €ì¥' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”. ë‚´ìš©ì„ ë¹„ìš°ê³  ì €ì¥í•˜ë©´ ë°°ë„ˆê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
                                </p>
                                <div id="adminBannersContainer" class="mt-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="right-banners" class="banner-container"></div>
    </div>
    <div class="modal fade" id="linkModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="modalTitle"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="alert alert-info small">ë„¤ì´ë²„ <b>ëª¨ë°”ì¼ ë²„ì „(m.blog.naver.com)</b> ë§í¬ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>(PCë²„ì „, <b>í´ë¦½(Clip)</b>, ë‹¨ì¶•URL, íƒ€ ë¸”ë¡œê·¸ ë¶ˆê°€)</div><p><strong>ì•„ì´ë””:</strong> <span id="modalUserId"></span></p><div class="mb-3"><label class="form-label">ë§í¬ 1 (í•„ìˆ˜)</label><input type="url" class="form-control" id="linkInput1" placeholder="https://m.blog.naver.com/..."></div><div class="mb-3"><label class="form-label">ë§í¬ 2</label><input type="url" class="form-control" id="linkInput2" placeholder="https://m.blog.naver.com/..."></div><div class="mb-3"><label class="form-label">ë§í¬ 3</label><input type="url" class="form-control" id="linkInput3" placeholder="https://m.blog.naver.com/..."></div><div id="linkModalAlert" class="alert mt-3 hidden" role="alert"></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button><button type="button" class="btn btn-danger hidden" id="deleteLinksButton">ì‚­ì œí•˜ê¸°</button><button type="button" class="btn btn-primary" id="saveLinksButton">ì €ì¥í•˜ê¸°</button></div></div></div></div>
    <div class="modal fade" id="completionModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">í’ˆì•—ì´ ì™„ë£Œ í™•ì¸</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>ê¸ˆì¼ ëª¨ë“  í’ˆì•—ì´ ì™„ë£Œ ë˜ì—ˆìŒì„ ë³´ê³  í•©ë‹ˆë‹¤. ì¢‹ì•„ìš”, ëŒ“ê¸€, ì²´ë¥˜ ì™„ë£Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p class="text-muted small">ì•„ë˜ í™•ì¸ë²„íŠ¼ ëˆ„ë¥´ì‹œë©´ ê¸ˆì¼ í’ˆì•—ì´ëŠ” ëª¨ë‘ ì™„ë£Œë©ë‹ˆë‹¤.</p><div id="completionModalAlert" class="alert mt-3 hidden" role="alert"></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button><button type="button" class="btn btn-primary" id="confirmCompletionButton">í™•ì¸</button></div></div></div></div>
    <div class="modal fade" id="adminPasswordModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">ê´€ë¦¬ì ë¡œê·¸ì¸</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="mb-3"><label for="adminPasswordInput" class="form-label">ë¹„ë°€ë²ˆí˜¸</label><input type="password" class="form-control" id="adminPasswordInput" autocomplete="new-password"></div><div id="adminPasswordAlert" class="alert alert-danger hidden" role="alert"></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button><button type="button" class="btn btn-primary" id="adminSubmitPasswordButton">ì§„ì…</button></div></div></div></div>
    <div class="modal fade" id="adminEditModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="adminEditTitle"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="adminEditUserId"><div class="mb-3"><label class="form-label">ìƒíƒœ (ACTIVE, BLOCKED)</label><input type="text" class="form-control" id="adminEditStatus"></div><div class="mb-3"><label class="form-label">íŒ¨ë„í‹° íšŸìˆ˜</label><input type="number" class="form-control" id="adminEditPenaltyCount" min="0"></div><div class="mb-3"><label class="form-label">ì ê¸ˆ ì¢…ë£Œì¼ (yyyy-mm-dd ë˜ëŠ” ë¹„ìš°ê¸°)</label><input type="text" class="form-control" id="adminEditLockoutDate"></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button><button type="button" class="btn btn-primary" id="adminSaveChangesButton">ë³€ê²½ì‚¬í•­ ì €ì¥</button></div></div></div></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyNRzMS3VBITKAdwlecbqRawQ1NNQ3YSZO6EKAKbRNDs4ouh8PA-O9LsraWlaKD2JId/exec';
    const ADMIN_PASSWORD_FRONT = "7702";
    document.addEventListener('DOMContentLoaded', () => {
        const authView = document.getElementById('authView');
        const mainView = document.getElementById('mainView');
        const adminView = document.getElementById('adminView');
        const allViews = [authView, mainView, adminView];
        const loginIdInput = document.getElementById('loginIdInput');
        const loginButton = document.getElementById('loginButton');
        const registerIdInput = document.getElementById('registerIdInput');
        const registerLinkInput = document.getElementById('registerLinkInput');
        const registerPostCountInput = document.getElementById('registerPostCountInput');
        const isMemberCheck = document.getElementById('isMemberCheck');
        const agreeTermsCheck = document.getElementById('agreeTermsCheck');
        const registerButton = document.getElementById('registerButton');
        const authAlert = document.getElementById('authAlert');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const userInfoText = document.getElementById('userInfoText');
        const logoutButton = document.getElementById('logoutButton');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const currentMonthYear = document.getElementById('currentMonthYear');
        const monthlyTotalCount = document.getElementById('monthlyTotalCount');
        const calendarBody = document.getElementById('calendarBody');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const completionBtn = document.getElementById('completionBtn');
        const completionTimer = document.getElementById('completionTimer');
        const reportContent = document.getElementById('reportContent');
        const linkModal = new bootstrap.Modal(document.getElementById('linkModal'));
        const completionModal = new bootstrap.Modal(document.getElementById('completionModal'));
        const adminPasswordModal = new bootstrap.Modal(document.getElementById('adminPasswordModal'));
        const adminEditModal = new bootstrap.Modal(document.getElementById('adminEditModal'));
        const modalTitle = document.getElementById('modalTitle');
        const modalUserId = document.getElementById('modalUserId');
        const linkInputs = [document.getElementById('linkInput1'), document.getElementById('linkInput2'), document.getElementById('linkInput3')];
        const linkModalAlert = document.getElementById('linkModalAlert');
        const saveLinksButton = document.getElementById('saveLinksButton');
        const deleteLinksButton = document.getElementById('deleteLinksButton');
        const confirmCompletionButton = document.getElementById('confirmCompletionButton');
        const completionModalAlert = document.getElementById('completionModalAlert');
        const adminPasswordInput = document.getElementById('adminPasswordInput');
        const adminSubmitPasswordButton = document.getElementById('adminSubmitPasswordButton');
        const adminPasswordAlert = document.getElementById('adminPasswordAlert');
        const adminUserTable = document.getElementById('adminUserTable');
        const exitAdminBtn = document.getElementById('exitAdminBtn');
        const adminAlert = document.getElementById('adminAlert');
        const adminDownloadTodayLinksBtn = document.getElementById('adminDownloadTodayLinksBtn');
        const adminBannersContainer = document.getElementById('adminBannersContainer');
        const leftBanners = document.getElementById('left-banners');
        const rightBanners = document.getElementById('right-banners');
        const adminEditTitle = document.getElementById('adminEditTitle');
        const adminEditUserId = document.getElementById('adminEditUserId');
        const adminEditStatus = document.getElementById('adminEditStatus');
        const adminEditPenaltyCount = document.getElementById('adminEditPenaltyCount');
        const adminEditLockoutDate = document.getElementById('adminEditLockoutDate');
        const adminSaveChangesButton = document.getElementById('adminSaveChangesButton');
        let currentCalendarDate = new Date();
        let loggedInUserId = null;
        let selectedDateStr = '';
        let completionInterval;

        function showView(viewToShow) { allViews.forEach(view => view.classList.add('hidden')); viewToShow.classList.remove('hidden'); }
        function showAlert(alertElement, message, type = 'danger') { alertElement.textContent = message; alertElement.className = `alert alert-${type}`; }
        function hideAlert(alertElement) { alertElement.classList.add('hidden'); }
        async function apiCall(action, params = {}) {
            const isGet = action.startsWith('get');
            const fullUrl = isGet ? `${SCRIPT_URL}?action=${action}&` + new URLSearchParams(params) : SCRIPT_URL;
            const options = { method: isGet ? 'GET' : 'POST', redirect: 'follow' };
            if (!isGet) {
                options.body = JSON.stringify({ action, ...params });
                options.headers = { "Content-Type": "text/plain;charset=utf-8" };
            }
            try {
                const response = await fetch(fullUrl, options);
                if (!response.ok) throw new Error("ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                const result = await response.json();
                if (result.status === 'error') throw new Error(result.message);
                return result.data;
            } catch (error) {
                console.error('API Call Error:', error);
                throw error;
            }
        }
        function init() {
            loggedInUserId = localStorage.getItem('pumasi_user_id');
            if (loggedInUserId) {
                showView(mainView);
                initializeApp();
            } else {
                showView(authView);
            }
            
            // ë¸”ë¡œê·¸ ì•„ì´ë”” ì…ë ¥ ì‹œ ìë™ ë§í¬ ìƒì„±
            registerIdInput.addEventListener('input', function() {
                const userId = this.value.trim();
                if (userId) {
                    registerLinkInput.value = `https://m.blog.naver.com/${userId}`;
                } else {
                    registerLinkInput.value = '';
                }
            });
        }
        function initializeApp() {
            welcomeMessage.textContent = loggedInUserId;
            const regDate = localStorage.getItem('pumasi_reg_date');
            if (regDate) { displayUserInfo(regDate); }
            renderCalendar(currentCalendarDate);
            startCompletionTimer();
            loadReportData();
            loadBanners(); // [ì‹ ê·œ] ë°°ë„ˆ ë¡œë”©
        }
        async function loadBanners() {
            try {
                const banners = await apiCall('getPublicBanners');
                leftBanners.innerHTML = '';
                rightBanners.innerHTML = '';
                banners.forEach(banner => {
                    const bannerEl = document.createElement('a');
                    bannerEl.href = banner.destinationUrl;
                    bannerEl.target = '_blank';
                    bannerEl.rel = 'noopener noreferrer';
                    bannerEl.innerHTML = `<img src="${banner.imageUrl}" alt="Banner ${banner.slotId}">`;

                    if(banner.slotId <= 5) {
                        leftBanners.appendChild(bannerEl);
                    } else {
                        rightBanners.appendChild(bannerEl);
                    }
                });
            } catch (error) {
                console.error('Failed to load banners:', error);
            }
        }
        function displayUserInfo(regDateStr) {
            if (!regDateStr) return;
            const regDate = new Date(regDateStr);
            const today = new Date();
            const todayUTC = new Date(Date.UTC(today.getFullYear(), today.getMonth(), today.getDate()));
            const regDateUTC = new Date(Date.UTC(regDate.getFullYear(), regDate.getMonth(), regDate.getDate()));
            const diffTime = todayUTC - regDateUTC;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
            userInfoText.textContent = `ê°€ì…ì¼: ${regDateStr} (ê°€ì… ${diffDays}ì¼ì°¨)`;
        }
        loginButton.addEventListener('click', async () => {
            const userId = loginIdInput.value.trim();
            if (!userId) { showAlert(authAlert, "ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }
            try {
                const data = await apiCall('loginUser', { userId });
                localStorage.setItem('pumasi_user_id', data.userId);
                localStorage.setItem('pumasi_reg_date', data.registrationDate);
                loggedInUserId = data.userId;
                showView(mainView);
                initializeApp();
            } catch (error) {
                showAlert(authAlert, error.message);
            }
        });
        registerButton.addEventListener('click', async () => {
            const userId = registerIdInput.value.trim();
            const blogLink = registerLinkInput.value.trim();
            const postCount = parseInt(registerPostCountInput.value) || 0;
            
            // ì…ë ¥ ê²€ì¦
            if (!userId || !blogLink) { 
                showAlert(authAlert, "ì•„ì´ë””ì™€ ë¸”ë¡œê·¸ ë§í¬ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”."); 
                return; 
            }
            
            if (postCount < 3) {
                showAlert(authAlert, "1ì£¼ì¼ í¬ìŠ¤íŒ… íšŸìˆ˜ëŠ” ìµœì†Œ 3íšŒ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
                return;
            }
            
            // ì²´í¬ë°•ìŠ¤ ê²€ì¦
            if (!isMemberCheck.checked) {
                showAlert(authAlert, "ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ…ë°© íšŒì› ì—¬ë¶€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
                return;
            }
            
            if (!agreeTermsCheck.checked) {
                showAlert(authAlert, "ì•ˆë‚´ë¬¸ ë‚´ìš©ì„ í™•ì¸í•˜ê³  ë™ì˜í•´ì£¼ì„¸ìš”.");
                return;
            }
            
            try {
                const data = await apiCall('registerUser', { userId, blogLink, postCount });
                showAlert(authAlert, data.message, 'success');
                document.getElementById('login-tab').click();
            } catch (error) {
                showAlert(authAlert, error.message);
            }
        });
        logoutButton.addEventListener('click', () => {
            localStorage.removeItem('pumasi_user_id');
            localStorage.removeItem('pumasi_reg_date');
            loggedInUserId = null;
            clearInterval(completionInterval);
            showView(authView);
            location.reload();
        });
        async function renderCalendar(date) {
            const year = date.getFullYear();
            const month = date.getMonth();
            currentMonthYear.textContent = `${year}ë…„ ${month + 1}ì›”`;
            calendarBody.innerHTML = `<div class="d-flex justify-content-center p-5"><div class="spinner-border text-success" role="status"><span class="visually-hidden">Loading...</span></div></div>`;
            monthlyTotalCount.textContent = '...';
            let linkCounts = {};
            try {
                linkCounts = await apiCall('getLinkCountsForMonth', { year: year, month: month + 1 });
            } catch (error) {
                console.error("Failed to fetch link counts:", error);
                monthlyTotalCount.textContent = 'ì˜¤ë¥˜';
            }
            calendarBody.innerHTML = '';
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            for (let i = 0; i < firstDay; i++) { calendarBody.innerHTML += `<div class="calendar-day other-month"></div>`; }
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            let totalLinksThisMonth = 0;
            for (let i = 1; i <= lastDate; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.classList.add('calendar-day');
                const dayOfWeek = new Date(year, month, i).getDay();
                if (dayOfWeek === 0) dayDiv.classList.add('sunday');
                else if (dayOfWeek === 6) dayDiv.classList.add('saturday');
                const dayLinkCount = linkCounts[i] || 0;
                totalLinksThisMonth += dayLinkCount;
                let countHtml = dayLinkCount > 0 ? `<div class="link-count">ì´ ${dayLinkCount}ê°œ</div>` : '';
                const currentDateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                if (currentDateStr === todayStr) {
                    dayDiv.classList.add('today', 'active-day');
                    dayDiv.dataset.date = currentDateStr;
                    dayDiv.innerHTML = `<div class="day-number">${i}</div><div class="today-marker">ğŸ‘‡ í´ë¦­!</div>${countHtml}`;
                } else {
                    dayDiv.innerHTML = `<div class="day-number">${i}</div>${countHtml}`;
                }
                calendarBody.appendChild(dayDiv);
            }
            monthlyTotalCount.textContent = `ì›” í•©ì‚°: ${totalLinksThisMonth}ê°œ`;
        }
        prevMonthBtn.addEventListener('click', () => { currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1); renderCalendar(currentCalendarDate); });
        nextMonthBtn.addEventListener('click', () => { currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1); renderCalendar(currentCalendarDate); });
        
        calendarBody.addEventListener('click', async (e) => {
            const dayElement = e.target.closest('.active-day');
            if (dayElement) {
                selectedDateStr = dayElement.dataset.date;
                modalTitle.textContent = `${selectedDateStr} ë§í¬ ë“±ë¡/ìˆ˜ì •`;
                modalUserId.textContent = loggedInUserId;
                linkInputs.forEach(input => input.value = '');
                hideAlert(linkModalAlert);
                saveLinksButton.textContent = 'ì €ì¥í•˜ê¸°';
                
                deleteLinksButton.classList.add('hidden');
                linkModal.show();
                
                try {
                    const existingLinks = await apiCall('getLinksForDate', { userId: loggedInUserId, date: selectedDateStr });
                    if (existingLinks && Array.isArray(existingLinks) && existingLinks.some(link => link)) {
                        saveLinksButton.textContent = 'ìˆ˜ì •í•˜ê¸°';
                        linkInputs[0].value = existingLinks[0] || '';
                        linkInputs[1].value = existingLinks[1] || '';
                        linkInputs[2].value = existingLinks[2] || '';
                        deleteLinksButton.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error("Error fetching links for date:", error);
                    showAlert(linkModalAlert, 'ë§í¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
                
                const nowKST = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Seoul" }));
                const kstHours = nowKST.getHours();

                if (kstHours >= 18) {
                    saveLinksButton.disabled = true;
                    saveLinksButton.title = "ì˜¤í›„ 6ì‹œ ì´í›„ì—ëŠ” ì €ì¥/ìˆ˜ì •ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.";
                    deleteLinksButton.disabled = true;
                    deleteLinksButton.title = "ì˜¤í›„ 6ì‹œ ì´í›„ì—ëŠ” ì‚­ì œê°€ ë¶ˆê°€í•©ë‹ˆë‹¤.";
                } else {
                    saveLinksButton.disabled = false;
                    saveLinksButton.title = "";
                    deleteLinksButton.disabled = false;
                    deleteLinksButton.title = "";
                }
            }
        });
        
        function validateLink(url) {
           if (!url.startsWith("https://m.blog.naver.com")) return false;
           if (url.toLowerCase().includes("clip")) return false;
           return true;
        }

        saveLinksButton.addEventListener('click', async () => {
            const links = linkInputs.map(input => input.value.trim()).filter(link => link);
            if (links.length === 0) { showAlert(linkModalAlert, 'ë§í¬ë¥¼ í•˜ë‚˜ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            for (const link of links) {
                if (!validateLink(link)) {
                    showAlert(linkModalAlert, 'ë„¤ì´ë²„ ëª¨ë°”ì¼ ë²„ì „ ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (Clip í¬í•¨ ë¶ˆê°€)');
                    return;
                }
            }
            saveLinksButton.disabled = true;
            try {
                const data = await apiCall('saveLinks', { userId: loggedInUserId, date: selectedDateStr, links });
                showAlert(linkModalAlert, data.message, 'success');
                setTimeout(() => { linkModal.hide(); renderCalendar(currentCalendarDate); }, 1500);
            } catch (error) {
                showAlert(linkModalAlert, error.message);
            } finally {
                const nowKST = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Seoul" }));
                if (nowKST.getHours() < 18) {
                    saveLinksButton.disabled = false;
                }
            }
        });

        deleteLinksButton.addEventListener('click', async () => {
            if (confirm(`ì •ë§ë¡œ ${selectedDateStr}ì— ë“±ë¡ëœ ëª¨ë“  ë§í¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                deleteLinksButton.disabled = true;
                try {
                    const data = await apiCall('deleteLinks', { userId: loggedInUserId, date: selectedDateStr });
                    showAlert(linkModalAlert, data.message, 'success');
                    setTimeout(() => { linkModal.hide(); renderCalendar(currentCalendarDate); }, 1500);
                } catch (error) {
                    showAlert(linkModalAlert, error.message);
                } finally {
                    const nowKST = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Seoul" }));
                    if (nowKST.getHours() < 18) {
                        deleteLinksButton.disabled = false;
                    }
                }
            }
        });

        function startCompletionTimer() {
            clearInterval(completionInterval);
            completionInterval = setInterval(updateCompletionButtonStatus, 1000);
            updateCompletionButtonStatus();
        }
        function updateCompletionButtonStatus() {
            const kstNow = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Seoul" }));
            const kstHours = kstNow.getHours();
            const kstMinutes = kstNow.getMinutes();
            const startTime = 18.5, endTime = 23.5;
            const currentTime = kstHours + kstMinutes / 60;

            if (currentTime >= startTime && currentTime < endTime) {
                completionBtn.disabled = false;
                completionTimer.textContent = "ì§€ê¸ˆ ì™„ë£Œ ë³´ê³ ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.";
            } else {
                completionBtn.disabled = true;
                let nextStart = new Date(kstNow);
                nextStart.setHours(18, 30, 0, 0);
                if (kstNow.getTime() > nextStart.getTime()) {
                    nextStart.setDate(nextStart.getDate() + 1);
                }
                const diff = nextStart - kstNow;
                const h = String(Math.floor(diff / 3600000)).padStart(2, '0');
                const m = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
                const s = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
                completionTimer.textContent = `ì™„ë£Œ ë³´ê³  í™œì„±í™”ê¹Œì§€ ë‚¨ì€ ì‹œê°„: ${h}:${m}:${s}`;
            }
        }
        completionBtn.addEventListener('click', () => {
            hideAlert(completionModalAlert);
            completionModal.show();
        });
        confirmCompletionButton.addEventListener('click', async () => {
            const todayKST = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Seoul" }));
            const todayStr = `${todayKST.getFullYear()}-${String(todayKST.getMonth() + 1).padStart(2, '0')}-${String(todayKST.getDate()).padStart(2, '0')}`;
            confirmCompletionButton.disabled = true;
            try {
                const data = await apiCall('recordCompletion', { userId: loggedInUserId, date: todayStr });
                showAlert(completionModalAlert, data.message, 'success');
                setTimeout(() => completionModal.hide(), 1500);
            } catch (error) {
                showAlert(completionModalAlert, error.message);
            } finally {
                confirmCompletionButton.disabled = false;
            }
        });
        async function loadReportData() {
            try {
                const data = await apiCall('getReportData');
                let html = `<p class="mb-2"><strong>ë³´ê³ ì„œ ë‚ ì§œ: ${data.date}</strong></p><p class="mb-3"><strong>ì™„ë£Œ ì¸ì›: ${data.completedCount}ëª…</strong></p><h5>ë¯¸ì™„ë£Œ íšŒì› ëª©ë¡</h5>`;
                if (data.incompleteUsers.length === 0) {
                    html += `<p class="text-muted">ë¯¸ì™„ë£Œ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
                } else {
                    html += `<ul class="list-group">`;
                    data.incompleteUsers.forEach(user => {
                        const newPenaltyCount = (parseInt(user.penaltyCount) || 0) + 1;
                        const penaltyClass = `penalty-${Math.min(newPenaltyCount, 3)}`;
                        html += `<li class="list-group-item">${user.userId} <span class="badge bg-warning text-dark ${penaltyClass}">íŒ¨ë„í‹° ${newPenaltyCount}íšŒ</span></li>`;
                    });
                    html += `</ul>`;
                }
                reportContent.innerHTML = html;
            } catch (error) {
                reportContent.innerHTML = `<p class="text-danger">ë³´ê³ ì„œ ë¡œë”© ì‹¤íŒ¨: ${error.message}</p>`;
            }
        }
        adminLoginBtn.addEventListener('click', () => {
            adminPasswordInput.value = '';
            hideAlert(adminPasswordAlert);
            adminPasswordModal.show();
        });
        adminSubmitPasswordButton.addEventListener('click', () => {
            const pass = adminPasswordInput.value;
            if (pass === ADMIN_PASSWORD_FRONT) {
                adminPasswordModal.hide();
                showView(adminView);
                adminFetchUsers();
                adminLoadBanners(); // [ì‹ ê·œ] ê´€ë¦¬ì ë°°ë„ˆ ê´€ë¦¬ UI ë¡œë”©
            } else {
                showAlert(adminPasswordAlert, "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
            }
        });
        exitAdminBtn.addEventListener('click', () => {
            showView(mainView);
        });

        adminDownloadTodayLinksBtn.addEventListener('click', async () => {
            const btn = adminDownloadTodayLinksBtn;
            btn.disabled = true;
            btn.textContent = 'íŒŒì¼ ìƒì„± ì¤‘...';
            hideAlert(adminAlert);
            try {
                const data = await apiCall('adminGenerateTodaysLinkReport', { password: ADMIN_PASSWORD_FRONT });
                if(data.downloadUrl) {
                    showAlert(adminAlert, 'íŒŒì¼ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë©ë‹ˆë‹¤.', 'success');
                    window.open(data.downloadUrl, '_blank');
                }
            } catch (error) {
                showAlert(adminAlert, error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ì˜¤ëŠ˜ ë§í¬ ëª©ë¡ ë‹¤ìš´ë¡œë“œ';
            }
        });

        async function adminFetchUsers() {
            try {
                const users = await apiCall('adminGetUserData', { password: ADMIN_PASSWORD_FRONT });
                adminUserTable.innerHTML = '';
                users.forEach(user => {
                    const tr = document.createElement('tr');
                    const lockoutDate = user.LockoutEndDate ? new Date(user.LockoutEndDate).toISOString().split('T')[0] : '';
                    const regDate = user.RegistrationDate ? new Date(user.RegistrationDate).toISOString().split('T')[0] : '';
                    
                    let statusKorean = '';
                    let statusClass = '';
                    if (user.Status === 'ACTIVE') {
                        statusKorean = 'í™œì„±';
                        statusClass = 'status-active';
                    } else if (user.Status === 'BLOCKED') {
                        statusKorean = 'ì°¨ë‹¨';
                        statusClass = 'status-blocked';
                    } else {
                        statusKorean = user.Status;
                    }

                    tr.innerHTML = `<td>${user.UserID}</td>
                                    <td><a href="${user.BlogLink}" target="_blank">${user.BlogLink}</a></td>
                                    <td>${regDate}</td>
                                    <td data-status="${user.Status}" class="${statusClass}">${statusKorean}</td>
                                    <td>${user.PenaltyCount}</td>
                                    <td>${lockoutDate}</td>
                                    <td><button class="btn btn-sm btn-primary admin-edit-btn" data-user-id="${user.UserID}">ê´€ë¦¬</button></td>`;
                    adminUserTable.appendChild(tr);
                });
            } catch (error) {
                showAlert(adminAlert, error.message);
            }
        }
        
        // [ì‹ ê·œ] ê´€ë¦¬ììš© ë°°ë„ˆ ê´€ë¦¬ UIë¥¼ ìƒì„±í•˜ê³  ë°ì´í„°ë¥¼ ì±„ìš°ëŠ” í•¨ìˆ˜
        async function adminLoadBanners() {
            hideAlert(adminAlert);
            adminBannersContainer.innerHTML = '<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';
            try {
                const banners = await apiCall('adminGetBanners', { password: ADMIN_PASSWORD_FRONT });
                let html = '';
                for (let i = 1; i <= 10; i++) {
                    const banner = banners.find(b => b.SlotID == i) || {};
                    const title = i <= 5 ? `ì¢Œì¸¡ ${i}ë²ˆ` : `ìš°ì¸¡ ${i-5}ë²ˆ`;
                    html += `
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="card-title">${title} (ìŠ¬ë¡¯ ${i})</h6>
                                <div class="mb-2">
                                    <label class="form-label small">ì´ë¯¸ì§€ URL</label>
                                    <input type="url" class="form-control" id="img-url-${i}" value="${banner.ImageURL || ''}">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">ì—°ê²° ë§í¬ URL</label>
                                    <input type="url" class="form-control" id="dest-url-${i}" value="${banner.DestinationURL || ''}">
                                </div>
                                <button class="btn btn-primary btn-sm admin-save-banner-btn" data-slot-id="${i}">ìŠ¬ë¡¯ ${i} ì €ì¥</button>
                            </div>
                        </div>
                    `;
                }
                adminBannersContainer.innerHTML = html;
            } catch (error) {
                showAlert(adminAlert, 'ë°°ë„ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // [ì‹ ê·œ] ê´€ë¦¬ì ë°°ë„ˆ ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ì²˜ë¦¬
        adminBannersContainer.addEventListener('click', async (e) => {
            if (e.target.classList.contains('admin-save-banner-btn')) {
                const btn = e.target;
                const slotId = btn.dataset.slotId;
                const imageUrl = document.getElementById(`img-url-${slotId}`).value.trim();
                const destinationUrl = document.getElementById(`dest-url-${slotId}`).value.trim();
                
                btn.disabled = true;
                btn.textContent = 'ì €ì¥ ì¤‘...';
                hideAlert(adminAlert);

                try {
                    const result = await apiCall('adminUpdateBanner', {
                        password: ADMIN_PASSWORD_FRONT,
                        bannerData: { slotId, imageUrl, destinationUrl }
                    });
                    showAlert(adminAlert, result.message, 'success');
                } catch(error) {
                    showAlert(adminAlert, error.message, 'danger');
                } finally {
                    btn.disabled = false;
                    btn.textContent = `ìŠ¬ë¡¯ ${slotId} ì €ì¥`;
                }
            }
        });

        adminUserTable.addEventListener('click', async (e) => {
            if (e.target.classList.contains('admin-edit-btn')) {
                const userId = e.target.dataset.userId;
                const row = e.target.closest('tr');
                const cells = row.querySelectorAll('td');
                adminEditTitle.textContent = `${userId}ë‹˜ ì •ë³´ ìˆ˜ì •`;
                adminEditUserId.value = userId;
                adminEditStatus.value = cells[3].dataset.status;
                adminEditPenaltyCount.value = cells[4].textContent;
                adminEditLockoutDate.value = cells[5].textContent;
                adminEditModal.show();
            }
        });
        adminSaveChangesButton.addEventListener('click', async () => {
            const userData = {
                UserID: adminEditUserId.value,
                Status: adminEditStatus.value.trim().toUpperCase(),
                PenaltyCount: parseInt(adminEditPenaltyCount.value, 10),
                LockoutEndDate: adminEditLockoutDate.value.trim()
            };
            adminSaveChangesButton.disabled = true;
            try {
                const data = await apiCall('adminUpdateUser', { password: ADMIN_PASSWORD_FRONT, userData });
                showAlert(adminAlert, data.message, 'success');
                adminEditModal.hide();
                adminFetchUsers();
            } catch (error) {
                showAlert(adminAlert, error.message);
            } finally {
                adminSaveChangesButton.disabled = false;
            }
        });

        init();
    });
    </script>
</body>
</html>
